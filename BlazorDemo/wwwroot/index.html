<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>BlazorDemo</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/site.css" rel="stylesheet" />
    <link href="css/spinkit.css" rel="stylesheet" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="monaco-editor/min/vs/editor/editor.main.css">
</head>
<body>
    <app>
        <div class="sk-folding-cube">
            <div class="sk-cube1 sk-cube"></div>
            <div class="sk-cube2 sk-cube"></div>
            <div class="sk-cube4 sk-cube"></div>
            <div class="sk-cube3 sk-cube"></div>
        </div>
    </app>

    <script src="_framework/blazor.webassembly.js"></script>

    <script>var require = { paths: { 'vs': 'monaco-editor/min/vs' } };</script>
    <script src="monaco-editor/min/vs/loader.js"></script>
    <script src="monaco-editor/min/vs/editor/editor.main.nls.js"></script>
    <script src="monaco-editor/min/vs/editor/editor.main.js"></script>


    <script>
        window.CreateMonacoEditor = (instance, source) => {
            var text1 = source;
            var text2 = source;
            var originalModel = monaco.editor.createModel(text1, "csharp");
            var modifiedModel = monaco.editor.createModel(text2, "csharp");

            var diffEditor = monaco.editor.createDiffEditor(document.getElementById("monaco_container"), {
                // You can optionally disable the resizing
                enableSplitViewResizing: false,
                originalEditable: true,
                scrollBeyondLastLine: false,
                automaticLayout: true
            });
            diffEditor.setModel({
                original: originalModel,
                modified: modifiedModel
            });
            diffEditor.getModifiedEditor().updateOptions({readOnly:true}); // make right-hand-side readonly

            var originalEditor = diffEditor.getOriginalEditor();
            originalEditor.onDidChangeModelContent(function (e) {
                //var person = prompt("Please enter your name", "Harry Potter");
                //dotnet.invokeMethodAsync('OnContentChanged', e.value);
                window.monacoEditor = diffEditor; // totally needed
                instance.invokeMethodAsync('JS_OnContentChanged');
            });

            window.monacoEditor = diffEditor;

            // closeable label stuff, not related to monaco
            {
                var closebtns = document.getElementsByClassName("close");
                var i;

                for (i = 0; i < closebtns.length; i++) {
                  closebtns[i].addEventListener("click", function() {
                    this.parentElement.style.display = 'none';
                  });
                }
            }

            return "created";
        };

        window.GetMonacoEditorContent = () => {
            return window.monacoEditor.getOriginalEditor().getValue();
        }

        window.SetMonacoEditorContent = (modifiedSource) => {
            window.monacoEditor.getModifiedEditor().setValue(modifiedSource);
            return "modified";
        }

        
    </script>

</body>
</html>
